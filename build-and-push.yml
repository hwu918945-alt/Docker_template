  - name: Set up QEMU for multi-platform builds
    uses: docker/setup-buildx-action@v3

  - name: Login to Docker Hub
    uses: docker/login-action@v2
    with:
      username: ${{ secrets.DOCKERHUB_USERNAME }}
      password: ${{ secrets.DOCKERHUB_TOKEN }}

  - name: Build and push image
    uses: docker/build-push-action@v5
    with:
      context: ./docker_local/docker_submission_template
      file: ./docker_local/docker_submission_template/Dockerfile
      platforms: linux/amd64
      push: true
      tags: |
        ${{ secrets.DOCKERHUB_USERNAME }}/fetus2026_submission:latest
        ${{ secrets.DOCKERHUB_USERNAME }}/fetus2026_submission:${{ github.sha }}
      build-args: |
        USER_ID=1000
        GROUP_ID=1000
